# Chat Workspace Configuration System

**VersiÃ³n:** v0.3.0  
**Fecha:** 9 de diciembre de 2025  
**Estado:** Production Ready (97% completado)

---

## ðŸ“‹ Tabla de Contenidos

1. [IntroducciÃ³n](#introducciÃ³n)
2. [ConfiguraciÃ³n BÃ¡sica](#configuraciÃ³n-bÃ¡sica)
3. [Referencia de ConfiguraciÃ³n](#referencia-de-configuraciÃ³n)
4. [Ejemplos de Uso](#ejemplos-de-uso)
5. [GuÃ­a de MigraciÃ³n](#guÃ­a-de-migraciÃ³n)
6. [Best Practices](#best-practices)
7. [Performance Tips](#performance-tips)
8. [Troubleshooting](#troubleshooting)
9. [API Reference](#api-reference)

---

## IntroducciÃ³n

El **Chat Workspace Configuration System** es un sistema de configuraciÃ³n granular que permite controlar todos los aspectos del componente `Workspace` mediante un Ãºnico array asociativo, en lugar de mÃºltiples props individuales.

### Beneficios Clave

- **ðŸŽ¯ ReutilizaciÃ³n:** Un componente configurable para mÃºltiples contextos (Quick Chat, Conversations, extensiones)
- **âš¡ Performance:** Carga condicional de recursos (15-39% reducciÃ³n en bundle size)
- **ðŸ”’ ValidaciÃ³n:** ValidaciÃ³n centralizada con reglas de tipos y lÃ³gica
- **ðŸ”„ Backward Compatible:** Legacy props siguen funcionando (sin breaking changes)
- **ðŸ› ï¸ Extensible:** Agregar opciones sin modificar API existente
- **ðŸ’¾ Persistence:** Guardado automÃ¡tico en base de datos por usuario

### Arquitectura

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Workspace Component                   â”‚
â”‚  (Blade Component: Workspace.php)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ $config array
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    ChatWorkspaceConfigValidator                 â”‚
â”‚  (Service: ValidaciÃ³n & Merge con Defaults)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â”‚ Validated Config
                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      WorkspacePreferencesController             â”‚
â”‚  (Persistence: DB + User Preferences)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ConfiguraciÃ³n BÃ¡sica

### Uso Simple (Config Array)

```php
// Controller
use Bithoven\LLMManager\Services\ChatWorkspaceConfigValidator;

public function index()
{
    $config = [
        'features' => [
            'monitor' => [
                'enabled' => true,
                'tabs' => [
                    'console' => true,
                    'request_inspector' => false,
                    'activity_log' => true,
                ],
            ],
        ],
    ];
    
    return view('admin.quick-chat.index', compact('config'));
}
```

```blade
{{-- View: resources/views/admin/quick-chat/index.blade.php --}}
<x-llm-manager-chat-workspace
    :session="$session"
    :configurations="$configurations"
    :config="$config"
/>
```

### Uso con Defaults

```php
// Usar configuraciÃ³n por defecto
use Bithoven\LLMManager\Services\ChatWorkspaceConfigValidator;

$config = ChatWorkspaceConfigValidator::getDefaults();

// O personalizar defaults
$config = array_merge(
    ChatWorkspaceConfigValidator::getDefaults(),
    [
        'ui' => [
            'mode' => 'canvas-only',
        ],
    ]
);
```

### Backward Compatibility (Legacy Props)

```blade
{{-- Forma antigua (sigue funcionando) --}}
<x-llm-manager-chat-workspace
    :session="$session"
    :configurations="$configurations"
    :show-monitor="true"
    monitor-layout="split-horizontal"
/>

{{-- Internamente se convierte a config array automÃ¡ticamente --}}
```

---

## Referencia de ConfiguraciÃ³n

### Estructura Completa

```php
$config = [
    /**
     * =====================
     * FEATURES
     * Control de caracterÃ­sticas principales
     * =====================
     */
    'features' => [
        
        // Monitor de Streaming
        'monitor' => [
            'enabled' => true,              // Master toggle (bool)
            'default_open' => false,        // Estado inicial open/closed (bool)
            'tabs' => [
                'console' => true,          // Tab Console (logs tiempo real) (bool)
                'request_inspector' => true, // Tab Request Inspector (debugging) (bool)
                'activity_log' => true,     // Tab Activity Log (historial) (bool)
            ],
        ],
        
        // Panel de Settings
        'settings_panel' => true,           // Mostrar panel de configuraciÃ³n (bool)
        
        // Persistencia
        'persistence' => true,              // Guardar mensajes en DB (bool)
        
        // Toolbar
        'toolbar' => true,                  // Mostrar barra de herramientas (bool)
    ],

    /**
     * =====================
     * UI ELEMENTS
     * Control granular de elementos visuales
     * =====================
     */
    'ui' => [
        
        // Layouts
        'layout' => [
            'chat' => 'bubble',             // Layout del chat
                                            // Valores: 'bubble', 'drawer', 'compact'
            
            'monitor' => 'split-horizontal', // Layout del monitor
                                            // Valores: 'drawer', 'tabs', 
                                            //          'split-horizontal', 
                                            //          'split-vertical', 'sidebar'
        ],
        
        // Botones de Toolbar
        'buttons' => [
            'new_chat' => true,             // BotÃ³n New Chat (bool)
            'clear' => true,                // BotÃ³n Clear Chat (bool)
            'settings' => true,             // BotÃ³n Settings (bool)
            'download' => true,             // BotÃ³n Download History (bool)
            'monitor_toggle' => true,       // BotÃ³n Toggle Monitor (bool)
        ],
        
        // Modo de VisualizaciÃ³n
        'mode' => 'full',                   // Modo del componente
                                            // Valores: 'full', 'demo', 'canvas-only'
    ],

    /**
     * =====================
     * PERFORMANCE
     * Optimizaciones de carga y rendimiento
     * =====================
     */
    'performance' => [
        'lazy_load_tabs' => true,           // Cargar tabs solo cuando se activan (bool)
        'minify_assets' => false,           // Minificar JS/CSS (solo production) (bool)
        'cache_preferences' => true,        // Cache en localStorage (bool)
    ],

    /**
     * =====================
     * ADVANCED
     * Opciones avanzadas para casos especiales
     * =====================
     */
    'advanced' => [
        'multi_instance' => false,          // MÃºltiples chats en misma pÃ¡gina (bool)
        'custom_css_class' => '',           // CSS class personalizada (string)
        'debug_mode' => false,              // Logs detallados en console (bool)
    ],
];
```

### Valores por Defecto

Para ver todos los defaults actuales:

```php
use Bithoven\LLMManager\Services\ChatWorkspaceConfigValidator;

$defaults = ChatWorkspaceConfigValidator::getDefaults();
dd($defaults);
```

**Defaults Actuales:**

| SecciÃ³n | OpciÃ³n | Default | Tipo |
|---------|--------|---------|------|
| `features.monitor.enabled` | Monitor habilitado | `true` | bool |
| `features.monitor.default_open` | Monitor abierto al inicio | `false` | bool |
| `features.monitor.tabs.console` | Tab Console | `true` | bool |
| `features.monitor.tabs.request_inspector` | Tab Request Inspector | `true` | bool |
| `features.monitor.tabs.activity_log` | Tab Activity Log | `true` | bool |
| `features.settings_panel` | Panel Settings | `true` | bool |
| `features.persistence` | Guardar mensajes | `true` | bool |
| `features.toolbar` | Mostrar toolbar | `true` | bool |
| `ui.layout.chat` | Layout chat | `'bubble'` | string |
| `ui.layout.monitor` | Layout monitor | `'split-horizontal'` | string |
| `ui.buttons.*` | Todos los botones | `true` | bool |
| `ui.mode` | Modo componente | `'full'` | string |
| `performance.lazy_load_tabs` | Lazy loading | `true` | bool |
| `performance.minify_assets` | MinificaciÃ³n | `false` | bool |
| `performance.cache_preferences` | Cache local | `true` | bool |
| `advanced.multi_instance` | Multi instancia | `false` | bool |
| `advanced.custom_css_class` | CSS class | `''` | string |
| `advanced.debug_mode` | Debug mode | `false` | bool |

---

## Ejemplos de Uso

### 1. Quick Chat (Monitor Completo)

```php
// Controller
public function quickChat()
{
    $config = [
        'features' => [
            'monitor' => [
                'enabled' => true,
                'default_open' => true,
                'tabs' => [
                    'console' => true,
                    'request_inspector' => true,
                    'activity_log' => true,
                ],
            ],
        ],
        'ui' => [
            'layout' => [
                'monitor' => 'split-horizontal',
            ],
        ],
    ];
    
    return view('admin.quick-chat.index', compact('config'));
}
```

**Resultado:** Monitor visible, split horizontal, todas las tabs habilitadas.

---

### 2. Conversations (Solo Console)

```php
public function conversations()
{
    $config = [
        'features' => [
            'monitor' => [
                'enabled' => true,
                'tabs' => [
                    'console' => true,          // âœ… Enabled
                    'request_inspector' => false, // âŒ Disabled
                    'activity_log' => false,     // âŒ Disabled
                ],
            ],
        ],
        'ui' => [
            'layout' => [
                'monitor' => 'sidebar',
            ],
        ],
    ];
    
    return view('conversations.index', compact('config'));
}
```

**Resultado:** Monitor en sidebar, solo Console tab visible.

---

### 3. Embedded Chat (Sin Monitor)

```php
public function embedded()
{
    $config = [
        'features' => [
            'monitor' => [
                'enabled' => false,         // âŒ Monitor completamente disabled
            ],
            'toolbar' => false,             // âŒ Sin toolbar
        ],
        'ui' => [
            'mode' => 'canvas-only',        // Solo el canvas de chat
        ],
    ];
    
    return view('embedded.chat', compact('config'));
}
```

**Resultado:** Solo canvas de chat, sin monitor ni toolbar.

---

### 4. Developer Mode (Debug Completo)

```php
public function developerMode()
{
    $config = ChatWorkspaceConfigValidator::getDefaults();
    
    $config['advanced']['debug_mode'] = true;
    $config['features']['monitor']['default_open'] = true;
    
    return view('developer.chat', compact('config'));
}
```

**Resultado:** Monitor abierto por defecto, console logs detallados.

---

### 5. Demo Mode (Presentation)

```php
public function demo()
{
    $config = [
        'features' => [
            'monitor' => ['enabled' => false],
            'persistence' => false,         // No guardar en DB
        ],
        'ui' => [
            'mode' => 'demo',
            'buttons' => [
                'download' => false,        // No download
                'settings' => false,        // No settings
            ],
        ],
    ];
    
    return view('demo.chat', compact('config'));
}
```

**Resultado:** Chat sin monitor, sin persistencia, sin botones de control.

---

### 6. Custom CSS & Theming

```php
public function customTheme()
{
    $config = [
        'advanced' => [
            'custom_css_class' => 'dark-theme compact-mode',
        ],
        'ui' => [
            'layout' => [
                'chat' => 'compact',
            ],
        ],
    ];
    
    return view('custom.chat', compact('config'));
}
```

```css
/* resources/css/custom-chat.css */
.dark-theme {
    background: #1a1a1a;
    color: #f0f0f0;
}

.compact-mode .chat-message {
    padding: 8px;
    margin: 4px 0;
}
```

**Resultado:** Chat con tema oscuro personalizado.

---

### 7. Multi-Instance (MÃºltiples Chats)

```php
public function multiChat()
{
    $config1 = [
        'advanced' => ['multi_instance' => true],
        'features' => ['monitor' => ['enabled' => false]],
    ];
    
    $config2 = [
        'advanced' => ['multi_instance' => true],
        'features' => ['monitor' => ['enabled' => true]],
    ];
    
    return view('multi-chat.index', compact('config1', 'config2'));
}
```

```blade
<div class="row">
    <div class="col-md-6">
        <x-llm-manager-chat-workspace :config="$config1" />
    </div>
    <div class="col-md-6">
        <x-llm-manager-chat-workspace :config="$config2" />
    </div>
</div>
```

**Resultado:** Dos chats independientes en la misma pÃ¡gina.

---

### 8. Performance Optimizado

```php
public function optimized()
{
    $config = [
        'performance' => [
            'lazy_load_tabs' => true,       // Tabs se cargan al activarse
            'minify_assets' => true,        // Assets minificados
            'cache_preferences' => true,    // Cache en localStorage
        ],
        'features' => [
            'monitor' => [
                'tabs' => [
                    'console' => false,     // Disabled (no carga JS)
                    'request_inspector' => true,
                    'activity_log' => false,
                ],
            ],
        ],
    ];
    
    return view('optimized.chat', compact('config'));
}
```

**Resultado:** Bundle size reducido ~30%, carga mÃ¡s rÃ¡pida.

---

### 9. Settings Panel Habilitado

```php
public function withSettings()
{
    // Load user preferences from DB
    $preference = auth()->user()->workspacePreference;
    
    $config = $preference ? $preference->config : ChatWorkspaceConfigValidator::getDefaults();
    
    return view('chat.with-settings', compact('config'));
}
```

**Resultado:** Usuario puede personalizar configuraciÃ³n vÃ­a Settings Panel.

---

### 10. API/Headless Mode

```php
public function apiMode()
{
    $config = [
        'features' => [
            'monitor' => ['enabled' => false],
            'toolbar' => false,
            'settings_panel' => false,
        ],
        'ui' => [
            'mode' => 'canvas-only',
        ],
    ];
    
    return response()->json([
        'config' => $config,
        'endpoint' => route('api.chat.stream'),
    ]);
}
```

**Resultado:** Chat minimalista para integraciÃ³n API.

---

## GuÃ­a de MigraciÃ³n

### Desde Legacy Props â†’ Config Array

#### Antes (Legacy Props)

```blade
<x-llm-manager-chat-workspace
    :session="$session"
    :configurations="$configurations"
    layout="bubble"
    :show-monitor="true"
    monitor-layout="split-horizontal"
    mode="full"
    :persist="true"
    :show-toolbar="true"
/>
```

#### DespuÃ©s (Config Array - Recomendado)

```php
// Controller
$config = [
    'features' => [
        'monitor' => ['enabled' => true],
        'persistence' => true,
        'toolbar' => true,
    ],
    'ui' => [
        'layout' => [
            'chat' => 'bubble',
            'monitor' => 'split-horizontal',
        ],
        'mode' => 'full',
    ],
];
```

```blade
<x-llm-manager-chat-workspace
    :session="$session"
    :configurations="$configurations"
    :config="$config"
/>
```

### MigraciÃ³n Gradual (Sin Breaking Changes)

**Paso 1:** MantÃ©n legacy props (backward compatible)

```blade
{{-- Esto sigue funcionando --}}
<x-llm-manager-chat-workspace
    :show-monitor="true"
    monitor-layout="split-horizontal"
/>
```

**Paso 2:** Agrega config array junto a legacy props

```blade
{{-- Config array tiene prioridad --}}
<x-llm-manager-chat-workspace
    :show-monitor="true"          {{-- Ignorado --}}
    :config="$config"             {{-- Usado --}}
/>
```

**Paso 3:** Elimina legacy props (cleanup)

```blade
{{-- Solo config array --}}
<x-llm-manager-chat-workspace :config="$config" />
```

### Mapeo de Props â†’ Config

| Legacy Prop | Config Path | Tipo |
|-------------|-------------|------|
| `$showMonitor` | `features.monitor.enabled` | bool |
| `$monitorOpen` | `features.monitor.default_open` | bool |
| `$layout` | `ui.layout.chat` | string |
| `$monitorLayout` | `ui.layout.monitor` | string |
| `$mode` | `ui.mode` | string |
| `$persist` | `features.persistence` | bool |
| `$showToolbar` | `features.toolbar` | bool |

---

## Best Practices

### 1. Usar Defaults como Base

```php
// âœ… GOOD: Merge con defaults
$config = array_merge(
    ChatWorkspaceConfigValidator::getDefaults(),
    [
        'features' => [
            'monitor' => ['enabled' => false],
        ],
    ]
);

// âŒ BAD: Config incompleto (puede romper validaciÃ³n)
$config = [
    'features' => ['monitor' => ['enabled' => false]],
];
```

### 2. Validar Siempre

```php
// âœ… GOOD: Validar antes de usar
use Bithoven\LLMManager\Services\ChatWorkspaceConfigValidator;

try {
    $validated = ChatWorkspaceConfigValidator::validate($config);
} catch (\InvalidArgumentException $e) {
    // Handle validation error
    report($e);
    $validated = ChatWorkspaceConfigValidator::getDefaults();
}
```

### 3. Persistir Preferencias de Usuario

```php
// âœ… GOOD: Guardar en DB
use Bithoven\LLMManager\Models\LLMUserWorkspacePreference;

$preference = LLMUserWorkspacePreference::updateOrCreate(
    ['user_id' => auth()->id()],
    ['config' => $validated]
);

// Cargar preferencias
$config = $preference->config ?? ChatWorkspaceConfigValidator::getDefaults();
```

### 4. Conditional Features

```php
// âœ… GOOD: Deshabilitar features no usadas (mejor performance)
$config = [
    'features' => [
        'monitor' => [
            'tabs' => [
                'console' => true,
                'request_inspector' => false,  // âŒ Disabled: No carga JS
                'activity_log' => false,       // âŒ Disabled: No carga JS
            ],
        ],
    ],
];

// Bundle size: -30% aproximadamente
```

### 5. Respetar Reglas LÃ³gicas

```php
// âŒ BAD: Monitor disabled pero tabs enabled
$config = [
    'features' => [
        'monitor' => [
            'enabled' => false,
            'tabs' => [
                'console' => true,  // âŒ ERROR: Inconsistente
            ],
        ],
    ],
];

// âœ… GOOD: Monitor disabled â†’ tabs disabled
$config = [
    'features' => [
        'monitor' => [
            'enabled' => false,
            'tabs' => [
                'console' => false,
                'request_inspector' => false,
                'activity_log' => false,
            ],
        ],
    ],
];
```

### 6. Usar Helper Methods en Blade

```blade
{{-- âœ… GOOD: Usar helper methods --}}
@if($isMonitorEnabled())
    <div class="monitor-panel">
        @if($isMonitorTabEnabled('console'))
            @include('llm-manager::components.chat.shared.monitor-console')
        @endif
    </div>
@endif

{{-- âŒ BAD: Acceso directo a $config --}}
@if($config['features']['monitor']['enabled'])
    {{-- Propenso a errores si estructura cambia --}}
@endif
```

### 7. Documentar Config Custom

```php
/**
 * Custom config para chat de soporte
 * 
 * Features:
 * - Monitor con solo Console tab
 * - Layout sidebar
 * - Sin persistence (demo mode)
 */
$supportChatConfig = [
    'features' => [
        'monitor' => [
            'enabled' => true,
            'tabs' => ['console' => true, 'request_inspector' => false, 'activity_log' => false],
        ],
        'persistence' => false,
    ],
    'ui' => ['layout' => ['monitor' => 'sidebar']],
];
```

---

## Performance Tips

### 1. Conditional Resource Loading

El sistema carga recursos (JS/CSS) solo para features habilitadas:

| ConfiguraciÃ³n | Bundle Size | ReducciÃ³n |
|---------------|-------------|-----------|
| **ALL ENABLED** | 119 KB | 0% (baseline) |
| **Monitor (1 tab)** | 102 KB | -15% |
| **No Monitor** | 85 KB | -29% |
| **Minimal** | 74 KB | -39% |

**Script de Benchmark:**

```bash
# Medir bundle size por configuraciÃ³n
./scripts/benchmark-conditional-loading.sh
```

### 2. Lazy Loading de Tabs

```php
$config = [
    'performance' => [
        'lazy_load_tabs' => true,  // Tabs se cargan al activarse
    ],
];
```

**Beneficio:** Primera carga mÃ¡s rÃ¡pida (~200-300ms menos).

### 3. Cache de Preferencias

```php
$config = [
    'performance' => [
        'cache_preferences' => true,  // localStorage cache
    ],
];
```

**Beneficio:** Settings Panel carga instantÃ¡neamente (sin DB query).

### 4. MinificaciÃ³n (Production)

```php
$config = [
    'performance' => [
        'minify_assets' => app()->environment('production'),
    ],
];
```

**Beneficio:** Bundle size reducido ~40%.

### 5. Disable Unused Features

```php
// En vez de ocultar con CSS
$config = [
    'features' => [
        'monitor' => ['enabled' => false],  // âœ… No carga JS/CSS
    ],
];

// âŒ BAD: Cargar y ocultar con CSS
$config = [
    'features' => [
        'monitor' => ['enabled' => true],
    ],
];
// Y luego en Blade: <div style="display:none">...</div>
```

---

## Troubleshooting

### Error: "Invalid chat workspace configuration"

**Causa:** Config no pasa validaciÃ³n.

**SoluciÃ³n:**

```php
try {
    $config = ChatWorkspaceConfigValidator::validate($config);
} catch (\InvalidArgumentException $e) {
    // Ver mensaje de error especÃ­fico
    dd($e->getMessage());
    
    // Usar defaults como fallback
    $config = ChatWorkspaceConfigValidator::getDefaults();
}
```

### Error: "Monitor tabs cannot be enabled when monitor.enabled is false"

**Causa:** Monitor disabled pero tabs enabled (regla lÃ³gica).

**SoluciÃ³n:**

```php
// âœ… FIX: Disable tabs cuando monitor disabled
$config = [
    'features' => [
        'monitor' => [
            'enabled' => false,
            'tabs' => [
                'console' => false,
                'request_inspector' => false,
                'activity_log' => false,
            ],
        ],
    ],
];
```

### Error: "Settings button cannot be enabled when toolbar is disabled"

**Causa:** Toolbar disabled pero settings button enabled.

**SoluciÃ³n:**

```php
// âœ… FIX: Disable settings button O enable toolbar
$config = [
    'features' => ['toolbar' => true],
    'ui' => ['buttons' => ['settings' => true]],
];
```

### Monitor No Aparece

**DiagnÃ³stico:**

```blade
{{-- Blade debugging --}}
@dump($config['features']['monitor']['enabled'])
@dump($isMonitorEnabled())
@dump($showMonitor)
```

**Causas comunes:**

1. `monitor.enabled => false`
2. Legacy prop `show-monitor` en `false`
3. Config no pasÃ³ a componente

### Settings Panel No Guarda

**DiagnÃ³stico:**

```javascript
// Console browser (F12)
console.log('Config antes de save:', this.config);

// Response del server
fetch('/admin/llm/workspace/preferences/save', {...})
    .then(res => res.json())
    .then(data => console.log('Server response:', data));
```

**Causas comunes:**

1. CSRF token missing
2. Ruta no registrada
3. ValidaciÃ³n falla en server

### Performance Lento

**DiagnÃ³stico:**

```bash
# Medir bundle size actual
./scripts/benchmark-conditional-loading.sh

# Ver quÃ© tabs estÃ¡n cargadas
# Browser DevTools â†’ Network â†’ Filter: JS
```

**Soluciones:**

1. Disable tabs no usadas
2. Enable lazy loading
3. Enable minification (production)
4. Check cache preferences

---

## API Reference

### ChatWorkspaceConfigValidator

#### `validate(array $config): array`

Valida y mergea config con defaults.

```php
use Bithoven\LLMManager\Services\ChatWorkspaceConfigValidator;

$validated = ChatWorkspaceConfigValidator::validate([
    'features' => ['monitor' => ['enabled' => false]],
]);

// Returns: Array completo con defaults mergeados
```

**Throws:** `InvalidArgumentException` si validaciÃ³n falla.

---

#### `getDefaults(): array`

Retorna configuraciÃ³n por defecto completa.

```php
$defaults = ChatWorkspaceConfigValidator::getDefaults();

// Returns:
[
    'features' => [...],
    'ui' => [...],
    'performance' => [...],
    'advanced' => [...],
]
```

---

### Workspace Component

#### Helper Methods

##### `isMonitorEnabled(): bool`

```php
// Component
public function isMonitorEnabled(): bool
{
    return $this->config['features']['monitor']['enabled'];
}
```

```blade
{{-- Blade --}}
@if($isMonitorEnabled())
    <div class="monitor-panel">...</div>
@endif
```

---

##### `isMonitorTabEnabled(string $tab): bool`

```php
// Component
public function isMonitorTabEnabled(string $tab): bool
{
    return $this->config['features']['monitor']['tabs'][$tab] ?? false;
}
```

```blade
{{-- Blade --}}
@if($isMonitorTabEnabled('console'))
    @include('llm-manager::components.chat.shared.monitor-console')
@endif
```

**Tabs disponibles:** `'console'`, `'request_inspector'`, `'activity_log'`

---

##### `isButtonEnabled(string $button): bool`

```php
// Component
public function isButtonEnabled(string $button): bool
{
    return $this->config['ui']['buttons'][$button] ?? false;
}
```

```blade
{{-- Blade --}}
@if($isButtonEnabled('settings'))
    <button>Settings</button>
@endif
```

**Buttons disponibles:** `'new_chat'`, `'clear'`, `'settings'`, `'download'`, `'monitor_toggle'`

---

##### `getMonitorLayout(): string`

```php
// Component
public function getMonitorLayout(): string
{
    return $this->config['ui']['layout']['monitor'];
}
```

```blade
{{-- Blade --}}
@if($getMonitorLayout() === 'split-horizontal')
    @include('llm-manager::components.chat.layouts.split-horizontal-layout')
@endif
```

**Layouts disponibles:** `'drawer'`, `'tabs'`, `'split-horizontal'`, `'split-vertical'`, `'sidebar'`

---

##### `getChatLayout(): string`

```php
// Component
public function getChatLayout(): string
{
    return $this->config['ui']['layout']['chat'];
}
```

**Layouts disponibles:** `'bubble'`, `'drawer'`, `'compact'`

---

### WorkspacePreferencesController

#### `save(Request $request): JsonResponse`

Guarda preferencias de usuario en DB.

```javascript
// AJAX request
fetch('/admin/llm/workspace/preferences/save', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
        'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').content,
    },
    body: JSON.stringify({ config: {...} }),
})
.then(res => res.json())
.then(data => {
    console.log('Saved:', data.success);
    if (data.needs_reload) {
        // Reload required
        window.location.reload();
    }
});
```

**Response:**

```json
{
    "success": true,
    "message": "Settings saved successfully",
    "needs_reload": false,
    "config": {...}
}
```

---

#### `get(Request $request): JsonResponse`

Obtiene preferencias de usuario desde DB.

```javascript
fetch('/admin/llm/workspace/preferences/get')
    .then(res => res.json())
    .then(data => {
        console.log('User config:', data.config);
    });
```

**Response:**

```json
{
    "success": true,
    "config": {...}
}
```

---

#### `reset(Request $request): JsonResponse`

Resetea a defaults.

```javascript
fetch('/admin/llm/workspace/preferences/reset', {
    method: 'POST',
    headers: {
        'X-CSRF-TOKEN': document.querySelector('meta[name="csrf-token"]').content,
    },
})
.then(res => res.json())
.then(data => {
    console.log('Reset to defaults:', data.config);
});
```

---

## Testing

### Unit Tests

```bash
# Ejecutar tests de validaciÃ³n
php vendor/bin/phpunit tests/Unit/Services/ChatWorkspaceConfigValidatorTest.php
```

**Test Cases (13/13 passing):**

- Empty config returns defaults
- Valid config passes
- Partial config merges with defaults
- Invalid layouts throw exception
- Logical rules validated

### Feature Tests

```bash
# Ejecutar tests de componentes
php vendor/bin/phpunit tests/Feature/Components/ChatWorkspaceConfigTest.php
```

**Test Cases (14/14 passing):**

- Component accepts config array
- Backward compatibility with legacy props
- Config priority over legacy props
- Helper methods work correctly
- Conditional rendering

### Todos los Tests

```bash
# Ejecutar ambos (Unit + Feature)
php vendor/bin/phpunit \
    tests/Unit/Services/ChatWorkspaceConfigValidatorTest.php \
    tests/Feature/Components/ChatWorkspaceConfigTest.php
```

**Resultado esperado:** 27/27 tests passing âœ…

---

## Changelog

### v0.3.0 (9 diciembre 2025)

- âœ… Config Array System implementado
- âœ… ChatWorkspaceConfigValidator con validaciÃ³n completa
- âœ… Workspace.php + ChatWorkspace.php refactorizados
- âœ… Backward compatibility 100%
- âœ… Settings Panel UI con DB persistence
- âœ… Conditional resource loading (15-39% bundle reduction)
- âœ… WorkspacePreferencesController (save/reset/get)
- âœ… Testing suite completo (27/27 passing)
- âœ… Helper methods en componentes
- âœ… Documentation completa

---

## Soporte

**Issues:** [GitHub Issues](https://github.com/Madniatik/bithoven-extension-llm-manager/issues)  
**Plan Detallado:** [PLAN-v0.3.0-chat-config-options.md](../plans/PLAN-v0.3.0-chat-config-options.md)  
**Plan Principal:** [PLAN-v0.3.0.md](../plans/PLAN-v0.3.0.md)

---

**Autor:** Claude (Claude Sonnet 4.5, Anthropic)  
**Fecha:** 9 de diciembre de 2025  
**VersiÃ³n:** 0.3.0
